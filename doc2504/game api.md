总结

模块	关键接口
账户	创建账户、查询账户
资金	充值、提现、查询余额、查询转账状态
游戏记录	查询历史记录、查询输赢统计


 风控校验机制
余额前后校验：资金操作后自动比对余额变化

异常金额检测：单次金额超阈值报警

频繁操作保护：单位时间内转账频率限制

IP/地域风控：异常IP、异常国家禁止转账

冻结保护：发现风险可冻结账户交易




为什么需要「预下单 + 确认转账」两步模式？
而不是直接扣款 + 事务 + 幂等？

1. ❗ 真实金融场景里，“转账”绝不是简单一次操作
资金转账在真实系统里，通常不是原子操作，而是跨系统链路：

钱包系统 → 游戏平台系统

或

银行系统 → 第三方支付系统 → 钱包系统

中间有很多【外部系统】要通信，这些外部操作无法纳入你的本地事务。

所以哪怕你本地事务成功了，但外部系统失败，资金就不同步了，出事故了。

2. ✨ 预下单的意义
预下单 是告诉你自己系统和用户：

“这笔交易准备好了，用户余额充足，风控也通过了，但还没真正扣钱。”

检查余额充足 ✅

检查风控限额通过 ✅

锁定用户余额（冻结） ✅

等确认后真正转账/扣款




4. 📣 为什么直接转账 + 幂等/事务还不够？   项目 直接转账 预下单+确认   本地事务控制 可以 可以  跨系统控制 难 好  失败回滚 复杂（容易漏扣/错扣） 简单（直接撤销预下单）  用户体验 差（突然失败、余额乱） 好（先准备、再确认）  风控介入 不灵活 灵活（预下单时就能打风控规则）  幂等控制 需要复杂幂等方案 简单用prepareId即可  防止脏数据 容易产生脏账 明确二阶段提交、几乎无脏账



5. 🏦 金融行业最佳实践（参考）   行业场景 使用模式   银行支付（银联/网联） 必须预下单后再确认  支付宝/微信支付 预下单（生成二维码/支付链接）→确认支付  第三方钱包（如Binance Pay） 预冻结后确认付款  xx平台资金对接 基本全部预下单+确认（防止黑客攻击/风控绕过）



6. 📋 简单比喻一下：
就像你去ATM取钱，
不是直接从你账户扣钱的。

而是：

输入密码 → 预下单（校验密码、校验余额）

按确认键 → 确认转账（真正吐钱+扣账）

如果在输入密码后ATM掉电，账户不会扣钱；
如果在确认后ATM掉电，后台还能根据交易号查账补偿。

就是这个道理。