

✅ 一、幂等 + 补偿机制（SAGA 模式）
这是 FaaS 场景中最常见的事务实现方式。

✔ 核心思想：
把每个业务步骤设计为可独立撤销（补偿）

每个函数执行成功后，记录状态

出错时，从当前状态回滚前面的步骤（调用对应补偿函数）



✅ 二、事件驱动 + 状态机编排（如 Step Functions）
✔ 适用场景：
使用 AWS Lambda + Step Functions

Azure Durable Functions

Aliyun FnF / Serverless Workflow

✔ 方法：
用状态机定义每一步操作、依赖关系、超时、重试、补偿逻辑

支持定义失败转移到某个状态（失败处理）

✔ 优点：
可视化、稳定

每一步失败都能定义补偿或终止行为



✅ 三、Eventual Consistency + 事件总线
✔ 核心方法：
每个函数调用完成后，发送一个事件到消息队列（Kafka, EventGrid 等）

下游函数消费事件，处理后再发下一步事件

事件驱动整个业务流程

✔ 实现一致性的关键：
幂等性处理

消息持久化（防止丢失）

死信队列 + 重试机制



✅ 四、TCC 模式（Try-Confirm-Cancel）
虽然较复杂，但适合对数据精度要求高的场景。

✔ 举例：
Try：冻结资源

Confirm：提交操作

Cancel：回滚资源

在 FaaS 中，可以通过调用三段式函数来实现 TCC 模式。

✅ 五、借助外部中间件服务实现事务
一些云平台或中间件支持事务管理器 / 分布式事务：

Aliyun Serverless App Engine（SAE） 支持微服务事务协调器

Apache ServiceComb Pack

Dapr（分布式应用运行时）中有支持状态管理 + Pub/Sub

🧠 总结对比表：

方法	是否适合 FaaS	优点	难点
幂等 + 补偿（SAGA）	✅	易实现，通用	要写补偿逻辑
状态机编排	✅	云原生，失败流程清晰	云服务依赖，调试复杂
事件驱动一致性	✅	灵活，解耦，适合微服务	幂等/重试/死信处理复杂
TCC 模式	可行（复杂）	精细控制，适用于金融等	实现复杂，需要资源冻结逻辑
外部事务协调服务	部分支持	标准化，抽象高	引入额外中间件，平台依赖