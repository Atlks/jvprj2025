维持数据一致性的方法 幂等 事务 锁 队列.md

、维持数据一致性的方法.md
├── 幂等
├── 事务
├── 锁
├── 队列
├── 版本控制
├── 分布式一致性协议（Raft/Paxos）
├── 补偿机制（SAGA）
├── 写前日志 / Binlog
├── 数据校验与修复
├── 双写校验
├── 最终一致性策略
├── 分布式缓存一致性
├── 限流熔断策略
├── CAP / BASE 理论



数据库有哪些维持数据一致性的机制 ,比如外键等


 说：
数据库为了维持 数据一致性（Data Consistency），提供了多种机制，涵盖约束、事务、锁等多个方面。下面是常见的几种：

✅ 一、结构级机制（Schema-Level）
1. 外键约束（Foreign Key）
   保证子表中的数据必须引用主表的合法主键。

防止“孤儿记录”，维护数据之间的引用完整性。

2. 唯一约束（UNIQUE）
   保证某字段（或字段组合）数据的唯一性，避免重复。

3. 主键（PRIMARY KEY）
   主键自动具有唯一性和非空约束，是表的唯一标识。

4. 非空约束（NOT NULL）
   限制字段不能为空，避免出现“不完整”的记录。

5. 检查约束（CHECK）
   控制字段的取值范围，例如 CHECK (age >= 0)。


✅ 三、并发控制机制
8. 锁机制（Locking）
   防止并发冲突，分为：

行级锁 / 表级锁

乐观锁（如使用版本号） / 悲观锁（如加数据库行锁）

9. MVCC（多版本并发控制）
   MySQL InnoDB 使用的技术，用快照实现并发一致性。

✅ 四、触发器（Triggers）
10. 触发器
    在插入、更新或删除操作前后自动执行，强制执行一致性逻辑。


🧠 小结图示：

类型	机制/技术
结构级	外键、主键、唯一、非空、检查
事务级	ACID、隔离级别
并发控制	锁机制、MVCC
行为响应	触发器
业务逻辑辅助	存储过程、视图、代码校验

✅ 你已经列出的方法：
幂等（Idempotency）

保证相同请求多次执行，结果一致

常用于重试机制、防止重复提交（如支付接口）

事务（Transaction）

保证原子性、一致性、隔离性、持久性（ACID）

如数据库事务、分布式事务（XA、TCC、SAGA）

锁（Locking）

包括悲观锁、乐观锁

例如：行锁、乐观版本控制、Redis 分布式锁等

队列（Queue）

消息顺序处理，削峰填谷，异步执行

如 Kafka、RabbitMQ、SQS 保证消息不丢、顺序性



🔍 可以补充的其他常用一致性策略：
版本号控制（Versioning）

乐观锁的实现方式之一，防止并发更新覆盖数据

分布式一致性协议

如 Paxos、Raft、ZAB（Zookeeper）

在多节点之间达成共识，常用于分布式协调

补偿机制（Compensation）

用于分布式事务失败后的回滚处理（SAGA 模式核心）

写前日志（WAL） / binlog

数据修改前记录日志，恢复一致性

MySQL 的 binlog、PostgreSQL 的 WAL

数据校验与修复机制

定期校验副本或缓存与源数据是否一致，进行修复

双写校验（Double Write Check）

写入多个系统后做一致性验证

如主库+缓存、数据库+搜索引擎等场景

最终一致性（Eventually Consistent）策略

不追求强一致，但通过延迟、重试、修正等方式达成一致

分布式缓存一致性策略

如 Cache Aside, Write-through, Write-behind

Redis、Memcached 的一致性策略设计

限流/熔断

间接保障一致性，防止过载或重复处理影响数据状态

CAP / BASE 理论模型支持

理解系统在一致性、可用性、分区容错性之间的取舍